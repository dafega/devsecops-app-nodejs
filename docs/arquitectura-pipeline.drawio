<mxfile host="app.diagrams.net" modified="2025-01-01T00:00:00.000Z" agent="draw.io" version="22.1.0" etag="arch-pipeline" type="device">
  <diagram name="CI Pipeline" id="pipeline-ci">
    <mxGraphModel dx="1200" dy="800" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1169" pageHeight="827" math="0" shadow="0">
      <root>
        <mxCell id="0"/>
        <mxCell id="1" parent="0"/>

        <!-- Título -->
        <mxCell id="title" value="Arquitectura del Pipeline CI - GitHub Actions" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontStyle=1;fontSize=16;" vertex="1" parent="1">
          <mxGeometry x="340" y="20" width="480" height="30" as="geometry"/>
        </mxCell>

        <!-- Trigger -->
        <mxCell id="trigger" value="Trigger&#xa;push: Feature/**, Bugfix/**&#xa;pull_request: main" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="480" y="70" width="200" height="60" as="geometry"/>
        </mxCell>

        <!-- Job 1: Análisis estático y SCA -->
        <mxCell id="job1" value="1. Análisis estático y SCA&#xa;&#xa;• Checkout&#xa;• Setup Node.js 20&#xa;• npm install&#xa;• ESLint (lint)&#xa;• npm audit (SCA)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;align=left;spacingLeft=10;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="440" y="180" width="280" height="100" as="geometry"/>
        </mxCell>

        <!-- Job 2: Unit tests -->
        <mxCell id="job2" value="2. Pruebas unitarias y coverage 80%&#xa;&#xa;• Checkout, Node 20, npm install&#xa;• npm run test:coverage (c8, ≥80%)&#xa;• Upload artifact: coverage-report" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;align=left;spacingLeft=10;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="440" y="320" width="280" height="90" as="geometry"/>
        </mxCell>

        <!-- Job 3: Docker + Trivy -->
        <mxCell id="job3" value="3. Docker Build y Trivy&#xa;&#xa;• Checkout&#xa;• Docker Buildx, build image&#xa;• Trivy: vuln OS + library (CRITICAL/HIGH)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;align=left;spacingLeft=10;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="440" y="450" width="280" height="90" as="geometry"/>
        </mxCell>

        <!-- Job 4: DAST -->
        <mxCell id="job4" value="4. DAST (OWASP ZAP Baseline)&#xa;&#xa;• Docker Compose up&#xa;• Wait API health&#xa;• ZAP Baseline scan (/api/bicycles)&#xa;• Upload artifact: zap-dast-report" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;align=left;spacingLeft=10;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="440" y="580" width="280" height="100" as="geometry"/>
        </mxCell>

        <!-- Flechas -->
        <mxCell id="e1" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;entryX=0.5;entryY=0;" edge="1" parent="1" source="trigger" target="job1">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="e2" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;entryX=0.5;entryY=0;" edge="1" parent="1" source="job1" target="job2">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="e3" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;entryX=0.5;entryY=0;" edge="1" parent="1" source="job2" target="job3">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="e4" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;entryX=0.5;entryY=0;" edge="1" parent="1" source="job3" target="job4">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>

        <!-- Leyenda needs -->
        <mxCell id="legend" value="needs:&#xa;Job 2 → Job 1&#xa;Job 3 → Job 1, Job 2&#xa;Job 4 → Job 3" style="text;html=1;strokeColor=none;fillColor=#f5f5f5;align=left;verticalAlign=top;spacingLeft=5;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="780" y="280" width="140" height="70" as="geometry"/>
        </mxCell>

        <!-- Artefactos -->
        <mxCell id="artifacts" value="Artefactos&#xa;• coverage-report (7 días)&#xa;• zap-dast-report (30 días)" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;align=left;spacingLeft=8;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="780" y="380" width="180" height="60" as="geometry"/>
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
